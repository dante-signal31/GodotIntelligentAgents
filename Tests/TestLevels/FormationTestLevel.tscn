[gd_scene load_steps=17 format=3 uid="uid://4h3ubldn68qj"]

[ext_resource type="PackedScene" uid="uid://bqiois541s161" path="res://Levels/BigObstacleCourtyard.tscn" id="1_o46ag"]
[ext_resource type="PackedScene" uid="uid://deejypkq5wrxw" path="res://Scenes/Target.tscn" id="2_dhgyl"]
[ext_resource type="PackedScene" uid="uid://ob6715i2iini" path="res://Scenes/SteeringBehaviors/UsherFormationAgent.tscn" id="3_o46ag"]
[ext_resource type="Script" uid="uid://dx0qtd4s5ksnv" path="res://Scripts/Groups/FormationShapeManager.cs" id="4_emhl0"]
[ext_resource type="PackedScene" uid="uid://cuiom4nbl5741" path="res://Scenes/SteeringBehaviors/SeekSteeringBehavior.tscn" id="4_o46ag"]
[ext_resource type="PackedScene" uid="uid://o1aayb5a0b4r" path="res://Scenes/Groups/FixedFormation.tscn" id="5_b4w4m"]
[ext_resource type="PackedScene" uid="uid://2ntv3njjewht" path="res://Scenes/Groups/ScalableFormation.tscn" id="5_emhl0"]
[ext_resource type="PackedScene" uid="uid://mxho5r22apy1" path="res://Scenes/SteeringBehaviors/MovingAgent.tscn" id="6_8csmf"]
[ext_resource type="PackedScene" uid="uid://cqbcg2qri2h4j" path="res://Scenes/Groups/FormationPattern.tscn" id="7_rin61"]
[ext_resource type="Resource" uid="uid://db716mmhs4qru" path="res://Resources/FormationPattern_Box3x5_Centered.tres" id="8_hubku"]
[ext_resource type="PackedScene" uid="uid://cf3nraba3xedm" path="res://Scenes/Groups/TwoLevelFormation.tscn" id="9_emhl0"]
[ext_resource type="PackedScene" uid="uid://drq0xfneg0o1y" path="res://Scenes/Groups/SmoothedWallAvoiderMember.tscn" id="10_b4w4m"]
[ext_resource type="PackedScene" uid="uid://b8ettivyhu5tv" path="res://Scenes/SteeringBehaviors/UsherHingeAgent.tscn" id="10_dhgyl"]
[ext_resource type="PackedScene" uid="uid://dibmh52j5pc6t" path="res://Scenes/SteeringBehaviors/UsherWaiterFormationAgent.tscn" id="14_8csmf"]
[ext_resource type="PackedScene" uid="uid://p1fj4pljujk6" path="res://Scenes/Groups/FormationObstacleManager.tscn" id="15_rin61"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_o46ag"]
size = Vector2(900, 300)

[node name="FormationTestLevel" type="Node2D"]

[node name="BigObstacleCourtyard" parent="." instance=ExtResource("1_o46ag")]

[node name="Target" parent="." instance=ExtResource("2_dhgyl")]
position = Vector2(5481, 2272)
gizmo_extents = 169.4

[node name="Camera2D" type="Camera2D" parent="."]
position = Vector2(3851, 2157)
zoom = Vector2(0.25, 0.25)

[node name="ScalableFormation" type="Node" parent="."]
process_mode = 4

[node name="UsherScalableFormationAgent" parent="ScalableFormation" node_paths=PackedStringArray("_agentParent", "_rightHinge", "_leftHinge") instance=ExtResource("3_o46ag")]
visible = false
position = Vector2(4868, 2899)
collision_layer = 17
velocity = Vector2(198.977, -20.2051)
MaximumSpeed = 200.0
StopSpeed = 3.0
MaximumRotationalDegSpeed = 360.0
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 1.0
_stopRotationRadThreshold = 0.017453292
ShowGizmos = true
GizmosColor = Color(1, 0, 0, 1)
RealisticTurns = true
DeviationToleranceBeforeTurn = 0.01
_agentParent = NodePath("..")
_rightHinge = NodePath("ScalableFormation/RightHinge")
_rightHingeRelativePosition = Vector2(0, 0)
_leftHinge = NodePath("ScalableFormation/LeftHinge")
_leftHingeRelativePosition = Vector2(0, 0)
_engagedHinge = null
_hingeTarget = null
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)

[node name="CollisionShape2D" type="CollisionShape2D" parent="ScalableFormation/UsherScalableFormationAgent" node_paths=PackedStringArray("_formationNode")]
position = Vector2(-150, -50)
rotation = 1.5707964
shape = SubResource("RectangleShape2D_o46ag")
script = ExtResource("4_emhl0")
_formationNode = NodePath("../ScalableFormation")
_formationShape = SubResource("RectangleShape2D_o46ag")
_isAlreadyInitialized = false

[node name="SeekSteeringBehavior" parent="ScalableFormation/UsherScalableFormationAgent" node_paths=PackedStringArray("Target") instance=ExtResource("4_o46ag")]
Target = NodePath("../../../Target")
ArrivalDistance = 20.0
ShowGizmos = true
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)

[node name="ScalableFormation" parent="ScalableFormation/UsherScalableFormationAgent" node_paths=PackedStringArray("_parentAgent", "_rightHinge", "_leftHinge") instance=ExtResource("5_emhl0")]
position = Vector2(0, -500)
rotation = 1.5707964
Distribution = 2
MemberRadius = 50.0
FormationDimensions = Vector2(1000, 400)
Density = Vector2(200, 200)
Quantity = 10
_memberScene = ExtResource("6_8csmf")
_distributionType = 2
_memberRadius = 50.0
_formationDimensions = Vector2(1000, 400)
_density = Vector2(200, 200)
_quantity = 10
_correctingQuantity = false
_correctingDimensions = false
_correctingDensity = false
_originGizmoRadius = 10
_gizmoTextOffset = Vector2(10, 10)
_formationFormerDimensions = Vector2(300, 100)
_parentAgent = NodePath("..")
_rightHinge = NodePath("RightHinge")
_leftHinge = NodePath("LeftHinge")

[node name="RightHinge" parent="ScalableFormation/UsherScalableFormationAgent/ScalableFormation" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(850, 50)
rotation = -1.5708
MaximumRotationalDegSpeed = 14.323945
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="LeftHinge" parent="ScalableFormation/UsherScalableFormationAgent/ScalableFormation" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(50, 50)
rotation = -1.5708
MaximumRotationalDegSpeed = 14.323945
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
GizmosColor = Color(1, 1, 0, 1)
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="TwoLevelFormation" type="Node" parent="."]

[node name="UsherTwoLevelFormationAgent" parent="TwoLevelFormation" node_paths=PackedStringArray("_agentParent", "_rightHinge", "_leftHinge") instance=ExtResource("3_o46ag")]
process_mode = 4
visible = false
position = Vector2(1353, 847)
MaximumSpeed = 200.0
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
ShowGizmos = true
GizmosColor = Color(0, 1, 0, 1)
RealisticTurns = true
DeviationToleranceBeforeTurn = 0.02
_agentParent = NodePath("..")
_rightHinge = NodePath("RightHinge")
_rightHingeRelativePosition = Vector2(0, 0)
_leftHinge = NodePath("LeftHinge")
_leftHingeRelativePosition = Vector2(0, 0)
_engagedHinge = null
_hingeTarget = null
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)

[node name="SeekSteeringBehavior" parent="TwoLevelFormation/UsherTwoLevelFormationAgent" node_paths=PackedStringArray("Target") instance=ExtResource("4_o46ag")]
Target = NodePath("../../../Target")
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)

[node name="TwoLevelFormation" parent="TwoLevelFormation/UsherTwoLevelFormationAgent" instance=ExtResource("9_emhl0")]
_memberScene = ExtResource("10_b4w4m")
_membersGenerated = false
_membersUpdated = false

[node name="FixedFormation" parent="TwoLevelFormation/UsherTwoLevelFormationAgent/TwoLevelFormation" instance=ExtResource("5_b4w4m")]
FormationPattern = null
_memberScene = ExtResource("2_dhgyl")
_formationPattern = null

[node name="FormationPattern" parent="TwoLevelFormation/UsherTwoLevelFormationAgent/TwoLevelFormation/FixedFormation" instance=ExtResource("7_rin61")]
Positions = ExtResource("8_hubku")
_originGizmoRadius = 10
_positionGizmoRadius = 50
_gizmoTextOffset = Vector2(10, 10)
_previousPositionsSize = 0
_recreatingPositionsNodes = false
_previousPositions = Array[Vector2]([])

[node name="RightHinge" parent="TwoLevelFormation/UsherTwoLevelFormationAgent" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(0, 400)
MaximumRotationalDegSpeed = 14.323945
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="LeftHinge" parent="TwoLevelFormation/UsherTwoLevelFormationAgent" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(0, -400)
MaximumRotationalDegSpeed = 14.323945
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
GizmosColor = Color(1, 0, 0, 1)
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="UsherWaiterTwoLevelFormationAgent" parent="TwoLevelFormation" node_paths=PackedStringArray("_agentParent", "_rightHinge", "_leftHinge") instance=ExtResource("14_8csmf")]
process_mode = 4
visible = false
position = Vector2(1271, 2386)
MaximumSpeed = 200.0
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
ShowGizmos = true
GizmosColor = Color(0, 1, 0, 1)
RealisticTurns = true
DeviationToleranceBeforeTurn = 0.02
_agentParent = NodePath("..")
_rightHinge = NodePath("RightHinge")
_rightHingeRelativePosition = Vector2(0, 0)
_leftHinge = NodePath("LeftHinge")
_leftHingeRelativePosition = Vector2(0, 0)
_engagedHinge = null
_hingeTarget = null
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)
_originalMaximumSpeed = 200.0
_originalAveragePositionDistance = 2703.412

[node name="SeekSteeringBehavior" parent="TwoLevelFormation/UsherWaiterTwoLevelFormationAgent" node_paths=PackedStringArray("Target") instance=ExtResource("4_o46ag")]
Target = NodePath("../../../Target")
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)

[node name="TwoLevelFormation" parent="TwoLevelFormation/UsherWaiterTwoLevelFormationAgent" instance=ExtResource("9_emhl0")]
_memberScene = ExtResource("10_b4w4m")
_membersGenerated = false
_membersUpdated = false

[node name="UsherFormation" parent="TwoLevelFormation/UsherWaiterTwoLevelFormationAgent/TwoLevelFormation" instance=ExtResource("5_b4w4m")]
FormationPattern = null
_memberScene = ExtResource("2_dhgyl")
_formationPattern = null

[node name="FormationPattern" parent="TwoLevelFormation/UsherWaiterTwoLevelFormationAgent/TwoLevelFormation/UsherFormation" instance=ExtResource("7_rin61")]
Positions = ExtResource("8_hubku")
_originGizmoRadius = 10
_positionGizmoRadius = 50
_gizmoTextOffset = Vector2(10, 10)
_previousPositionsSize = 0
_recreatingPositionsNodes = false
_previousPositions = Array[Vector2]([])

[node name="RightHinge" parent="TwoLevelFormation/UsherWaiterTwoLevelFormationAgent" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(0, 400)
MaximumRotationalDegSpeed = 14.323945
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="LeftHinge" parent="TwoLevelFormation/UsherWaiterTwoLevelFormationAgent" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(0, -400)
MaximumRotationalDegSpeed = 14.323945
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
GizmosColor = Color(1, 0, 0, 1)
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="UsherWaiterObstacleManagedTwoLevelFormationAgent" parent="TwoLevelFormation" node_paths=PackedStringArray("_agentParent", "_rightHinge", "_leftHinge") instance=ExtResource("14_8csmf")]
position = Vector2(2332, 3108)
MaximumSpeed = 200.0
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
ShowGizmos = true
GizmosColor = Color(0, 1, 0, 1)
DeviationToleranceBeforeTurn = 0.02
_agentParent = NodePath("..")
_rightHinge = NodePath("RightHinge")
_rightHingeRelativePosition = Vector2(0, 0)
_leftHinge = NodePath("LeftHinge")
_leftHingeRelativePosition = Vector2(0, 0)
_engagedHinge = null
_hingeTarget = null
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)
_originalMaximumSpeed = 200.0
_originalAveragePositionDistance = 3885.6

[node name="FormationObstacleManager" parent="TwoLevelFormation/UsherWaiterObstacleManagedTwoLevelFormationAgent" node_paths=PackedStringArray("_iTargeterBehavior", "_iFormation", "_iFormationUshers") instance=ExtResource("15_rin61")]
ObstacleDetectionRadius = null
_iTargeterBehavior = NodePath("../SeekSteeringBehavior")
_iFormation = NodePath("../TwoLevelFormation")
_iFormationUshers = NodePath("../TwoLevelFormation/UsherFormation")

[node name="SeekSteeringBehavior" parent="TwoLevelFormation/UsherWaiterObstacleManagedTwoLevelFormationAgent" node_paths=PackedStringArray("Target") instance=ExtResource("4_o46ag")]
Target = NodePath("../../../Target")
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)

[node name="TwoLevelFormation" parent="TwoLevelFormation/UsherWaiterObstacleManagedTwoLevelFormationAgent" instance=ExtResource("9_emhl0")]
_memberScene = ExtResource("10_b4w4m")
_membersGenerated = false
_membersUpdated = false

[node name="UsherFormation" parent="TwoLevelFormation/UsherWaiterObstacleManagedTwoLevelFormationAgent/TwoLevelFormation" instance=ExtResource("5_b4w4m")]
FormationPattern = null
_memberScene = ExtResource("2_dhgyl")
_formationPattern = null

[node name="FormationPattern" parent="TwoLevelFormation/UsherWaiterObstacleManagedTwoLevelFormationAgent/TwoLevelFormation/UsherFormation" instance=ExtResource("7_rin61")]
Positions = ExtResource("8_hubku")
_originGizmoRadius = 10
_positionGizmoRadius = 50
_gizmoTextOffset = Vector2(10, 10)
_previousPositionsSize = 15
_recreatingPositionsNodes = false
_previousPositions = Array[Vector2]([Vector2(0, -400), Vector2(0, -200), Vector2(0, 0), Vector2(0, 200), Vector2(0, 400), Vector2(-200, -400), Vector2(-200, -200), Vector2(-200, 0), Vector2(-200, 200), Vector2(-200, 400), Vector2(-400, -400), Vector2(-400, -200), Vector2(-400, 0), Vector2(-400, 200), Vector2(-400, 400)])

[node name="RightHinge" parent="TwoLevelFormation/UsherWaiterObstacleManagedTwoLevelFormationAgent" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(0, 400)
MaximumRotationalDegSpeed = 14.323945
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="LeftHinge" parent="TwoLevelFormation/UsherWaiterObstacleManagedTwoLevelFormationAgent" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(0, -400)
MaximumRotationalDegSpeed = 14.323945
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
GizmosColor = Color(1, 0, 0, 1)
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="FixedFormation" type="Node" parent="."]
process_mode = 4

[node name="UsherFormationAgent" parent="FixedFormation" node_paths=PackedStringArray("_agentParent", "_rightHinge", "_leftHinge") instance=ExtResource("3_o46ag")]
visible = false
position = Vector2(2310, 3105)
collision_layer = 17
velocity = Vector2(198.977, -20.2051)
MaximumSpeed = 200.0
StopSpeed = 3.0
MaximumRotationalDegSpeed = 360.0
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 1.0
_stopRotationRadThreshold = 0.017453292
ShowGizmos = true
GizmosColor = Color(1, 0, 0, 1)
RealisticTurns = true
DeviationToleranceBeforeTurn = 0.01
_agentParent = NodePath("..")
_rightHinge = NodePath("RightHinge")
_rightHingeRelativePosition = Vector2(0, 0)
_leftHinge = NodePath("LeftHinge")
_leftHingeRelativePosition = Vector2(0, 0)
_engagedHinge = null
_hingeTarget = null
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)

[node name="CollisionShape2D" type="CollisionShape2D" parent="FixedFormation/UsherFormationAgent"]
position = Vector2(-201.5, 0.5)
shape = SubResource("RectangleShape2D_o46ag")

[node name="SeekSteeringBehavior" parent="FixedFormation/UsherFormationAgent" node_paths=PackedStringArray("Target") instance=ExtResource("4_o46ag")]
Target = NodePath("../../../Target")
ArrivalDistance = 20.0
ShowGizmos = true
_showGizmos = false
_gizmosColor = Color(0, 0, 0, 0)

[node name="FixedFormation" parent="FixedFormation/UsherFormationAgent" instance=ExtResource("5_b4w4m")]
FormationPattern = null
_memberScene = ExtResource("6_8csmf")
_formationPattern = null

[node name="FormationPattern" parent="FixedFormation/UsherFormationAgent/FixedFormation" instance=ExtResource("7_rin61")]
Positions = ExtResource("8_hubku")
_originGizmoRadius = 10
_positionGizmoRadius = 50
_gizmoTextOffset = Vector2(10, 10)
_previousPositionsSize = 0
_recreatingPositionsNodes = false
_previousPositions = Array[Vector2]([])

[node name="RightHinge" parent="FixedFormation/UsherFormationAgent" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(0, 401)
MaximumRotationalDegSpeed = 14.288225
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="LeftHinge" parent="FixedFormation/UsherFormationAgent" node_paths=PackedStringArray("_faceSteeringBehavior") instance=ExtResource("10_dhgyl")]
position = Vector2(0, -401)
MaximumRotationalDegSpeed = 14.288225
_agentColor = Color(0, 1, 0, 1)
_autoSmoothSamples = 10
_maximumRotationSpeedRadNormalized = 3.0
_stopRotationRadThreshold = 0.017453292
GizmosColor = Color(1, 1, 0, 1)
_targetToLookAt = null
_faceSteeringBehavior = NodePath("FaceSteeringBehavior")

[node name="Positions" type="Node" parent="."]

[node name="Position1" type="Marker2D" parent="Positions"]
position = Vector2(2332, 3109)

[node name="Position2" type="Marker2D" parent="Positions"]
position = Vector2(3283, 3093)

[node name="Position3" type="Marker2D" parent="Positions"]
position = Vector2(3268, 1190)

[node name="Position4" type="Marker2D" parent="Positions"]
position = Vector2(2347, 1157)

[node name="Position5" type="Marker2D" parent="Positions"]
position = Vector2(6923, 2408)

[editable path="FixedFormation/UsherFormationAgent/FixedFormation/FormationPattern"]
